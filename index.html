<meta name="viewport" content="width=device-width"/>
<style>
  :root {
    --color-background: #000;
    --color-text: #fff;
  }

  * {
    box-sizing: border-box;
  }

  @import url('https://rsms.me/inter/inter.css');
  html { font-family: 'Inter', sans-serif; }
  @supports (font-variation-settings: normal) {
    html { font-family: 'Inter var', sans-serif; }
  }

  body {
    background: var(--color-background);
    color: var(--color-text);
    max-width: 50em;
    margin: auto;
    padding: 2em;
  }

  ::selection {
    background-color: var(--color-text);
    color: var(--color-background);
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  .card {
    margin: 5em 0;
  }

  .card__title {
    font-size: 1.8em;
  }

  .card__image {
    width: 100%;
    border-radius: .5em;
    filter: saturate(75%);
  }

  .card__source {
    font-weight: normal;
  }

  .card__source-icon {
    width: 1em;
    height: 1em;
    vertical-align: top;
  }

  .card__description {
    line-height: 1.7em;
  }

  .btn--more {
    border: 1px solid var(--color-text);
    background: transparent;
    color: var(--color-text);
    font-size: 1.5em;
    width: 100%;
    padding: .5em 5em;
    display: block;
  }

  .btn--more:hover {
    background: var(--color-text);
    color: var(--color-background);
  }

  @media (min-width: 50em) {
    body {
      padding: 3em;
    }

    .btn--more {
      margin: 0 auto;
      width: auto;
      cursor: pointer;
    }

    .card__image {
      width: 100%;
      border-radius: 1em;
    }
  }
</style>

<h1>r_</h1>

<script type="module">

import feedList from './feedList.js';

fetch('/api/feeds?offset=25&dlength=280')
  .then(res => res.json())
  .then(items => items.map(renderItem).join(''))
  .then(content => document.body.insertAdjacentHTML('beforeEnd', content));

function formatDate(date) {
  return (new Date(date)).toLocaleTimeString([], { timeStyle: 'short' }).toLowerCase();
}

function renderItem(props) {
  const feedProps = Object.values(feedList)[props.feed];
  return `
    <article class="card">
      <h2 class="card__title">
        <a class="card__link" href=${props.link} target="_blank">${props.title}</a>
      </h2>
      <h3 class="card__source">
        <a href=${Object.values(feedList)[props.feed].domain} target="_blank">
          <img
            src="${!feedProps.altFavicon ? `${feedProps.domain}/favicon.ico` : feedProps.altFavicon}"
            class="card__source-icon"
            loading="lazy"
          />
          ${Object.keys(feedList)[props.feed]}
        </a> &middot; <time>${formatDate(props.date)}</time>
      </h3>
      ${props.image && `
        <a href=${props.link} target="_blank">
          <img class="card__image" src="${props.image}"/>
        </a>`
      }
      <p class="card__description">${props.description}</p>
    </article>
  `;
}

</script>
